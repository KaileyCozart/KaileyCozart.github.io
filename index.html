<!-- Written by: Kailey Cozart -->
<!-- References and Sources Listed at Document End: Denoted by [n]-->

<!-- Run Instructions:
    1) In command prompt either: 
    Python 3: python -m http.server 8000
    Python 2: python -m SimpleHTTPServer 8000
    2) In browser: http://localhost:8000/
    3) Navigate to location of index.html
-->

<!-- Limitations:
    1) Only tested in Chrome
    2) Not designed for devices smaller than 1100px
-->

<!DOCTYPE html>
    <meta content="utf-8" http-equiv="encoding">

    <head>
        <title>Kailey's Portfolio</title>

        <!-- D3 JS Library -->
        <script type="text/javascript" src="d3.v5.min.js"></script>
        <script type="text/javascript" src="d3-dsv.min.js"></script>
        <script type="text/javascript" src="d3-tip.min.js"></script>
        
        <!-- CSS -->
        <style>
            /* Encompassing CSS */
            body, svg {
                background-color: #1e3504;
            }

            /* Hero Div Component */
            body {
                margin: 0px;
            }

            .heroDiv {
                height: 400px;
                width: 100%;
                background: url(images/hero-photo.jpg) no-repeat center center fixed;
                    -webkit-background-size: cover;
                    -moz-background-size: cover;
                    -o-background-size: cover;
                    background-size: cover;
                padding-top: 100px;
                text-align: center;
            }

            .heroDiv::before { /* Color Overlay */
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 500px; /* Div's height + padding-top */
                background-color: rgba(229, 235, 223, 0.514);
            }
 
            @font-face { /* [1] Special Font */
                font-family: showtime;
                src: url(showtime_font/Showtime-Regular.otf) format('otf'),
                    url(showtime_font/Showtime-Regular.woff) format('woff'),
                    url(showtime_font/Showtime-Regular.woff2) format('woff2'),
                    url(showtime_font/Showtime-Regular.ttf) format('ttf');
            }

            .fancyText {
                position: relative;
                z-index: 1;
                font-family: showtime;
                font-weight: bold;
                color: black;
                font-size: 100px;
                margin-top: 0px;
                padding-top: 80px;
            }

            /* Shared Component CSS */
            #master-content-div {
                width: 1099px;
                margin: auto;
                padding-top: 30px;
                padding-bottom: 30px;
            }

            #bubble-chart > svg, #line-chart > svg, #bar-chart > svg {
                background-color: white;
                border-radius: 8px;
                margin-bottom: 1px;
            }

            .container {
                float: left;
            }

            .title {
                font-family: sans-serif;
            }

            .axis-text {
                font-size: 13px;
                font-weight: bolder;
            }

            .chart-text {
                font-size: 11.5px;
            }
            
            /* Bubble Chart Component */
            .bubble {
                font-family: sans-serif;
            }

            /* Line Chart Component */
            .line-label-text {
                font-size: 10px;
                font-family: sans-serif;
                letter-spacing: 0.15px;
                font-weight: bold;
            }

            /* Bar Chart Component */
            #bar-chart { 
                margin-left: 5px;
            }

            /* Table Component */
            #table-title {
                font-size: 15px;
                font-weight: bold;
            }

            td,th {
                font-family: sans-serif;
            }
            
            th {
                font-size: 14px;
                text-transform: capitalize;
                border: 0px black solid;
                padding: 5px;
                padding-left: 10px;
                background-color: white;
                font-weight: normal;
                text-align: left;
            }

            td {
                border: 0px black solid;
                padding: 5px;
                padding-left: 10px;
                line-height: 1.15
            }

            #table-title-row th:first-child { /* CSS to Round Top Left Corner */
            border-top-left-radius: 6px;
            }

            #table-title-row th:last-child { /* CSS to Round Top Right Corner */
            border-top-right-radius: 6px;
            }

            table tr:last-child td:first-child { /* [2] CSS to Bottom Left Corner */
            border-bottom-left-radius: 6px;
            }

            table tr:last-child td:last-child { /* [2] CSS to Bottom Right Corner */
            border-bottom-right-radius: 6px;
            }

        </style>
    </head>

    <body>
        <!-- HTML Elements -->
        <div class="heroDiv">
            <h1 class="fancyText">&lt;Kailey's Portfolio /&gt;</h1>
        </div>
        <div id="master-content-div">
            <div id="bubble-chart" class="container"></div>
            <div id="line-chart" class="container"></div>
            <div id="bar-chart" class="container"></div>
            <div id="table" class="container"></div>   
        </div>

        <!-- D3 Code -->
        <script>
            // Define Dimensions for SVGs
            margin = ({top: 20, right: 30, bottom: 30, left: 40})
            var height = 500
            var width = 954

            ////  Bubble Chart  //////////////////////////////////////////////////////////////////
            // File to be Loaded for Bubble Chart
            var bubbleChartProm = d3.csv("bubble-chart-data.csv")

            ////  Line Chart  //////////////////////////////////////////////////////////////////
            // Create Line Chart Container
            var lineChartSvgNoGroup = d3.select("#line-chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right - (width / 2))
                .attr("height", height + margin.top + margin.bottom - (height/ 2 ) + 50)

            // Add Spacing for Line Chart within SVG
            var moveLineChartHorizontal = 20
            var moveLineChartVertical = 30

            var lineChartSvg = lineChartSvgNoGroup.append("g") // This is split from above for dropdown changes
                .attr("transform","translate(" + (margin.left + moveLineChartHorizontal) + "," + (margin.top + moveLineChartVertical) + ")")

            // File to be Loaded for Line Chart
            var lineChartProm = d3.csv("line-chart-data.csv")
            
            ////  Bar Chart  //////////////////////////////////////////////////////////////////
            // Create Bar Chart Container
            var barChartSvgNoGroup = d3.select("#bar-chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right - (width / 2))
                .attr("height", height + margin.top + margin.bottom - (height/ 2 ) + 50)

            // Add Spacing for Bar Chart within SVG
            var moveBarChartHorizontal = 75
            var moveBarChartVertical = 30

            var barChartSvg = barChartSvgNoGroup.append("g") // This is split from above for dropdown changes
                .attr("transform","translate(" + (margin.left + moveBarChartHorizontal) + "," + (margin.top + moveBarChartVertical) + ")")

            // File to be Loaded for Bar Chart
            var barChartProm = d3.csv("bar-chart-data.csv")

            ////  Table  //////////////////////////////////////////////////////////////////
            // File to be Loaded for Table
            var tableProm = d3.text("table-data.csv")
            
            ////  Promises  //////////////////////////////////////////////////////////////////
            Promise.all(
                [bubbleChartProm, lineChartProm, barChartProm, tableProm]
            ).then(
                ready
            )

            ////  Ready  //////////////////////////////////////////////////////////////////
            function ready(data) { // This is called when the data has been read
                // We Now Unpack Loaded Data

                ////  Bubble Chart  //////////////////////////////////////////////////////////////////
                bubbleChartData = data[0].map(function(d) {
                    return {
                        name: d.name,
                        value: +d.value / 10 - 35 // Read values as numbers, re-size values for bubbles
                    }
                })

                ////  Line Chart  //////////////////////////////////////////////////////////////////
                var lineChartData = data[1]

                ////  Bar Chart  //////////////////////////////////////////////////////////////////
                var barChartData = data[2].sort(function(b, a){return a.value - b.value})

                ////  Table  //////////////////////////////////////////////////////////////////
                var tableData  = d3.csvParseRows(data[3])

                // Initial Render of All Components
                createBubbleChart(bubbleChartData)
                createLineChart(lineChartData)
                createBarChart(barChartData)
                createTable(tableData)
            }

            ////  Bubble Chart  //////////////////////////////////////////////////////////////////
            function createBubbleChart(bubbleChartData) {
                var bubbleContainerWidth = 1100
                var bubbleContainerHeight = 500

                // Create SVG for Chart
                var bubbleChartSvg = d3.select("#bubble-chart")
                    .append("svg")
                    .attr("width", bubbleContainerWidth)
                    .attr("height", bubbleContainerHeight)

                // Add Chart Title
                bubbleChartSvg.append("text")
                    .text("Coursework Taken - Weighted by Couse Number")
                    .attr("class", "title")
                    .attr("x", width / 2 - 100)
                    .attr("y", 30)

                // [3] Create Simulation
                var simulation = d3.forceSimulation(bubbleChartData)
                    .force("center", d3.forceCenter(bubbleContainerWidth / 2, bubbleContainerHeight / 2 + 25)) // Force center of simulation to be in the middle of the div
                    .force("collide", d3.forceCollide().radius(function(d) { return d.value + 2 })) // Force the bubbles to be near eachother with "+ n" pixels in between
                    .force("x", d3.forceX().strength(0.03).x(function(d) { return (d.value * 7) - 30050})) // Pull bubbles' x coordinate in the direction of the center
                    .force("y", d3.forceY().strength(0.03).y(function(d) { return bubbleContainerHeight / 2 })) // Pull bubbles' y coordinate in the direction of the center

                // [3] Create Bubbles
                var bubbles = bubbleChartSvg.selectAll(".bubble")
                    .data(bubbleChartData)
                    .enter().append("g")
                    .attr("class", "bubble")
                    .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")" })

                bubbles.append("circle")
                    .attr("r", function(d) { return d.value}) // Radius is the number in the value column of our csv
                    .style("fill", "#bec991") // Bubble color

                // [3] Create Bubble Labels
                bubbles.append("text")
                    .attr("dy", ".35em") // Moving the y coordinate of the label so that the label is in the center of the circle
                    .style("text-anchor", "middle") // Anchor the text in the middle of the bubble
                    .text(function(d) { return d.name }) // Label is the string value inside the name column of our csv

                // [3] Start Simulation
                simulation.on("tick", function() {
                    bubbles.attr("transform", function(d) { 
                        return "translate(" + Math.max(d.value, Math.min(bubbleContainerWidth - d.value, d.x)) + "," 
                        + Math.max(d.value, Math.min(bubbleContainerHeight - d.value, d.y)) + ")" })
                })
            }

            ////  Line Chart  //////////////////////////////////////////////////////////////////
            function createLineChart(lineChartData) {

                // Add Chart Title
                lineChartSvg.append("text")
                    .text("Degree Completion over Time")
                    .attr("class", "title")
                    .attr("x", 90)
                    .attr("y", -15)

                // Create X Axis
                var x = d3.scaleTime()
                    .domain(d3.extent(lineChartData, function(d) { return d3.timeParse("%Y-%m-%d")(d.date) }))
                    .range([0, width / 2 - 100])
                
                lineChartSvg.append("g")
                    .attr("transform", "translate(0," + height / 2 + ")")
                    .call(d3.axisBottom(x)
                        .tickValues(x.ticks().filter(function(d, i) { // Only show every nth tick
                            return i % 1 === 0
                        }))
                        .tickFormat(d3.timeFormat("%Y")))  
                        .attr("class", "chart-text")

                // Create X Axis Group
                var x_axis = lineChartSvg.append("g")
                    .attr("id", "x-axis-a")
                    .attr("transform", "translate(0," + height + ")") // Flipping to the bottom
                    .call(d3.axisBottom(x))

                // Add X Axis Label
                x_axis.append("text")
                    .text("Year")
                    .attr("class", "axis-text")
                    .attr("x", 185)
                    .attr("y", -215)
                    .style("fill", "black")

                // Max Value Observed for Y Axis
                const max = 100

                // Create Y Axis
                var y = d3.scaleLinear()
                    .domain([0, max])
                    .range([height / 2, 0])
                y_axis = lineChartSvg.append("g")
                    .call(d3.axisLeft(y))
                    .attr("class", "chart-text")

                // Add Y Axis Label
                y_axis.append("text")
                    .text("Percentage Complete")
                    .attr("class", "axis-text")
                    .attr("transform", "rotate(-90)")
                    .attr("x", -60)
                    .attr("y", -35)
                    .style("fill", "black")

                // Create Group for Lines
                var linesElement = lineChartSvg.append("g")
                    .attr("id", "lines")

                // Set Color Gradient: From [4]
                // To Use, Write: "url(#line-gradient)"
                /* lineChartSvg.append("linearGradient")
                .attr("id", "line-gradient")
                .attr("gradientUnits", "userSpaceOnUse")
                .attr("x1", 0)
                .attr("y1", y(0))
                .attr("x2", 0)
                .attr("y2", y(max))
                .selectAll("stop")
                    .data([
                    {offset: "0%", color: "lightpurple"}, // Previously lightpurple
                    {offset: "100%", color: "rgb(116, 196, 118)"} // Previously lightgreen
                    ])
                .enter()
                    .append("stop")
                    .attr("offset", function(d) { return d.offset })
                    .attr("stop-color", function(d) { return d.color }) */
                
                // Create Line Colors for Series
                var colors = ["#36563e", "#907350"]

                // Create Labels for Series
                seriesLabels = ["BA Computer Science", "MS Computer Science"]

                // Create Lines and Labels
                for (let i in seriesLabels) {
                    var line = linesElement // Lines
                        .append("path")
                        .datum(lineChartData)
                        .attr("d", d3.line()
                        .x(d => { return x(d3.timeParse("%Y-%m-%d")(d.date)) })
                        .y(d => { const yValue = y(d[seriesLabels[i]])
                            return yValue}))
                        .attr("class", "line")
                        .attr("id", "line-number-" + i)
                        .attr("stroke-width", 3)
                        .style("fill","none")
                        .style("stroke", colors[i])
                        .style("stroke-dasharray", ("3, 3"))
                        .on("mouseover", function () {
                            d3.select(this).style("stroke-dasharray", null)
                        })
                        .on("mouseout", function () {
                            d3.select(this).style("stroke-dasharray", ("3, 3"))
                        })
                    
                    linesElement // Line Text Labels
                        .append("text")
                        .datum(lineChartData)
                        .text(seriesLabels[i])
                        .attr("x", 382)
                        .attr("y", function (d) {
                                return y(d[d.length - 1][seriesLabels[i]]) + 2
                            })
                        .attr("class", "line-label-text") 
                        .style("fill", "black")
                        .on("mouseover", function () {
                            var thisLineNumber = "#line-number-" + i
                            d3.select(thisLineNumber).style("stroke-dasharray", null)
                        })
                        .on("mouseout", function () {
                            var thisLineNumber = "#line-number-" + i
                            d3.select(thisLineNumber).style("stroke-dasharray", ("3, 3"))
                        })
                }
            }

            ////  Bar Chart  //////////////////////////////////////////////////////////////////
            // Based on [4]
            function createBarChart(barChartData) {

                // Add Chart Title
                barChartSvg.append("text")
                    .text("Coursework Taken - Weighted by Couse Number")
                    .attr("class", "title")
                    .attr("x", width / 4 - 170)
                    .attr("y", -15)

                // Create Y Axis
                var y = d3.scaleBand()
                    .range([0, height / 2])
                    .domain(barChartData.map(function (d) { return d.song_feature }))
                    .padding(0.2)

                // Create Y Axis Group
                var y_axis = barChartSvg.append("g")
                    .attr("id", "y-axis-a")
                    .call(d3.axisLeft(y))
                    .attr("class", "chart-text")

                // Add Y Axis Label
                y_axis.append("text")
                    .text("Feature")
                    .attr("class", "axis-text")
                    .attr("transform", "rotate(-90)")
                    .attr("x", -100)
                    .attr("y", -90)
                    .style("fill", "black")

                // Create X Axis
                var maxValue = d3.max(barChartData, function (d) { return d.value }) * 1.05 // Max value of X plus a buffer of 0.05
                var x = d3.scaleLinear()
                    .domain([0, maxValue])
                    .range([0, width / 2 - 80])

                // Add X Axis
                var x_axis = barChartSvg.append("g")
                    .call(d3.axisBottom(x))
                    .attr("class", "chart-text")
                    .attr("transform", "translate(0," + height / 2 + ")")

                // Add X Axis Label
                x_axis.append("text")
                    .text("Mean Decrease in Impurity")
                    .attr("class", "axis-text")
                    .attr("x", width / 4 - 65)
                    .attr("y", 35)
                    .style("fill", "black")

                // Create Bars
                barChartSvg.selectAll("mybar")
                    .data(barChartData)
                    .enter()
                    .append("rect")
                    .attr("x", 0)
                    .attr("y", function (d) { return y(d.song_feature) })
                    .attr("width", function (d) { return x(d.value) })
                    .attr("height", y.bandwidth())
                    .attr("fill", "#36563e")
                    .on("mouseover", function () {
                        d3.select(this).attr("fill", "#bec991")
                    })
                    .on("mouseout", function () {
                        d3.select(this).attr("fill", "#36563e")
                    })
            }

            ////  Table  //////////////////////////////////////////////////////////////////
            // Based on [5]
            function createTable(tableData) {

                // Create Table Element
                table = d3.select('#table').append('table')
                            .style("border-collapse", "collapse")
                            .style("border", "0px black solid")
                            .style("width", "1099px") // TODO: Pass in choropleth_width

                // Add a Centered Table Title Row
                var captionRow = table.append("thead")
                    .append("tr")
                    .attr("id", "table-title-row")

                captionRow.append("th")
                    .attr("colspan", tableData[0].length)
                    .attr("id", "table-title")
                    .style("text-align", "center")
                    .text("Work Experience")

                // Create Header Row
                table.append("thead")
                    .append("tr")
                    .selectAll("th")
                    .data(tableData[0])
                    .enter()
                    .append("th")
                    .style("background-color", "#bec991")
                    .text(d => d)

                // Create Non-header Table Rows
                var tbody = table.append("tbody")

                // Add Subsequent Rows
                tbody.selectAll("tr")
                    .data(tableData.slice(1))
                    .enter()
                    .append("tr")
                    .selectAll("td")
                    .data(d => d)
                    .enter()
                    .append("td")
                    .style("background-color", "white")
                    .on("mouseover", function(){
                        d3.select(this).style("background-color", "#bec991")
                    })
                    .on("mouseout", function(){
                        d3.select(this).style("background-color", "white")
                    })
                    .text(d => d)
                    .style("font-size", "12px")
            }

        </script>
    </body>
</html>

<!-- Sources:
    [1] pixelsurplus.com/products/showtime-free-handmade-calligraphy-font -- Font for Top Div
    [2] stackoverflow.com/questions/628301/the-border-radius-property-and-border-collapsecollapse-dont-mix-how-can-i-use -- Border Styling for Table
    [3] d3indepth.com/force-layout/ -- For Simulation Involving Bubbles
    [4] d3-graph-gallery.com/graph/barplot_ordered.html -- For Bar Chart Example
    [5] codepen.io/blackjacques/pen/RYVpKZ -- For Line Chart Example
    [6] color-hex.com/color-palette/60344, color-hex.com/color-palette/36578 -- Color Palettes
    [n-1] Some additional help from AI tools via Google searches and OpenAI queries. -- For all sections.
    [n] My previous d3 hw assignments in CSE6242. -- For all sections, especially promises, line charts, bar charts, and tables.

    Not Used Yet:
    [?] d3-graph-gallery.com/graph/line_color_gradient_svg.html -- For Color Gradient Creation
    [?] d3-graph-gallery.com/graph/interactivity_tooltip.html -- For an example of a tooltip.
    [?] stackoverflow.com/questions/22452112/nvd3-clear-svg-before-loading-new-chart -- For clearning svg.
-->