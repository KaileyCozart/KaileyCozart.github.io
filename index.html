<!-- Written by: Kailey Cozart -->
<!-- References and Sources Listed at Document End: Denoted by [n]-->

<!DOCTYPE html>
    <meta content="utf-8" http-equiv="encoding">

    <head>
        <title>Kailey's Portfolio</title>

        <!-- D3 JS Library -->
        <script type="text/javascript" src="d3.v5.min.js"></script>
        <script type="text/javascript" src="d3-tip.min.js"></script>
        <script type="text/javascript" src="d3-dsv.min.js"></script>
        
        <!-- CSS -->
        <style>
            /* Encompassing CSS */
            body, svg {
                background-color: #212121;
            }

            #master-content-div {
                width: 1099px;
                margin: auto;
                padding-top: 30px;
                padding-bottom: 30px;
            }

            /* Hero Div Component */
            body {
                margin: 0px;
            }

            .heroDiv {
                height: 400px;
                width: 100%;
                background: url(images/hero-photo.jpg) no-repeat center center fixed;
                    -webkit-background-size: cover;
                    -moz-background-size: cover;
                    -o-background-size: cover;
                    background-size: cover;
                padding-top: 200px;
                text-align: center;
            }
 
            @font-face {
                font-family: showtime;
                src: url(showtime_font/Showtime-Regular.otf) format('otf'),
                    url(showtime_font/Showtime-Regular.woff) format('woff'),
                    url(showtime_font/Showtime-Regular.woff2) format('woff2'),
                    url(showtime_font/Showtime-Regular.ttf) format('ttf');
            }

            .fancyText {
                font-family: showtime;
                font-weight: bold;
                color: black;
                font-size: 100px;
                margin-top: 0px;
            }

            /* Shared Non-choropleth CSS */
            #line-chart > svg, #bar-chart > svg {
                background-color: #fdfdfd;
                border-radius: 8px;
                margin-bottom: 1px;
            }

            .container {
                float: left;
            }

            .axis-text {
                font-size: 13px;
                font-weight: bolder;
            }

            .chart-text {
                font-size: 11.5px;
            }

            /* Line Chart Component */

            .line-label-text {
                font-size: 10px;
                font-family: sans-serif;
                letter-spacing: 0.15px;
                font-weight: bold;
            }

            /* Bar Chart Component */
            #bar-chart { 
                margin-left: 5px;
            }

            /* Table Component */
            #table-title {
                font-size: 15px;
                font-weight: bold;
            }

            td,th {
                font-family: sans-serif;
            }
            
            th {
                font-size: 14px;
                text-transform: capitalize;
                border: 0px black solid;
                padding: 5px;
                padding-left: 10px;
                background-color: #fdfdfd;
                font-weight: normal;
                text-align: left;
            }

            td {
                border: 0px black solid;
                padding: 5px;
                padding-left: 10px;
                line-height: 1.15
            }

            #table-title-row th:first-child { /* CSS to Round Top Left Corner */
            border-top-left-radius: 6px;
            }

            #table-title-row th:last-child { /* CSS to Round Top Right Corner */
            border-top-right-radius: 6px;
            }

            table tr:last-child td:first-child { /* [1] CSS to Bottom Left Corner */
            border-bottom-left-radius: 6px;
            }

            table tr:last-child td:last-child { /* [1] CSS to Bottom Right Corner */
            border-bottom-right-radius: 6px;
            }

        </style>
    </head>

    <body>
        <!-- HTML Elements -->
        <div class="heroDiv">
            <h1 class="fancyText">&lt;Kailey's Portfolio /&gt;</h1>
        </div>
        <div id="master-content-div">
            <div id="bubble-chart" class="container"></div>
            <div id="line-chart" class="container"></div>
            <div id="bar-chart" class="container"></div>
            <div id="table" class="container"></div>   
        </div>

        <!-- D3 Code -->
        <script>
            // Define Dimensions for SVGs
            margin = ({top: 20, right: 30, bottom: 30, left: 40})
            var height = 500
            var width = 954

            ////  Bubble Chart  //////////////////////////////////////////////////////////////////
            // Create Bubble Chart Container
            var bubbleChartSvgNoGroup = d3.select("#bubble-chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right - (width / 2))
                .attr("height", height + margin.top + margin.bottom - (height/ 2 ) + 50)

            // Add Spacing for Bubble Chart within SVG
            var moveBubbleChartHorizontal = 20
            var moveBubbleChartVertical = 30

            var bubbleChartSvg = bubbleChartSvgNoGroup.append("g") // This is split from above for dropdown changes
                .attr("transform","translate(" + (margin.left + moveBubbleChartHorizontal) + "," + (margin.top + moveBubbleChartVertical) + ")")

            // File to be Loaded for Bubble Chart
            var bubbleChartProm = d3.json("bubble-chart-data.json")

            ////  Line Chart  //////////////////////////////////////////////////////////////////
            // Create Line Chart Container
            var lineChartSvgNoGroup = d3.select("#line-chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right - (width / 2))
                .attr("height", height + margin.top + margin.bottom - (height/ 2 ) + 50)

            // Add Spacing for Line Chart within SVG
            var moveLineChartHorizontal = 20
            var moveLineChartVertical = 30

            var lineChartSvg = lineChartSvgNoGroup.append("g") // This is split from above for dropdown changes
                .attr("transform","translate(" + (margin.left + moveLineChartHorizontal) + "," + (margin.top + moveLineChartVertical) + ")")

            // File to be Loaded for Line Chart
            var lineChartProm = d3.csv("line-chart-data.csv")
            
            ////  Bar Chart  //////////////////////////////////////////////////////////////////
            // Create Bar Chart Container
            var barChartSvgNoGroup = d3.select("#bar-chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right - (width / 2))
                .attr("height", height + margin.top + margin.bottom - (height/ 2 ) + 50)

            // Add Spacing for Bar Chart within SVG
            var moveBarChartHorizontal = 75
            var moveBarChartVertical = 30

            var barChartSvg = barChartSvgNoGroup.append("g") // This is split from above for dropdown changes
                .attr("transform","translate(" + (margin.left + moveBarChartHorizontal) + "," + (margin.top + moveBarChartVertical) + ")")

            // File to be Loaded for Bar Chart
            var barChartProm = d3.csv("bar-chart-data.csv")

            ////  Table  //////////////////////////////////////////////////////////////////
            // File to be Loaded for Table
            var tableProm = d3.text("table-data.csv")
            
            ////  Promises  //////////////////////////////////////////////////////////////////
            Promise.all(
                [lineChartProm, barChartProm, tableProm, bubbleChartProm]
            ).then(
                ready
            )

            ////  Ready  //////////////////////////////////////////////////////////////////
            function ready(data) { // This is called when the data has been read
                // We Now Unpack Loaded Data

                ////  Bubble Chart  //////////////////////////////////////////////////////////////////
                var bubbleChartData  = data[3]

                ////  Line Chart  //////////////////////////////////////////////////////////////////
                var lineChartData = data[0]

                ////  Bar Chart  //////////////////////////////////////////////////////////////////
                var barChartData = data[1].sort(function(b, a){return a.value - b.value})

                ////  Table  //////////////////////////////////////////////////////////////////
                var tableData  = d3.csvParseRows(data[2])

                // Initial Render of All Components
                createBubbleChart(bubbleChartData)
                createLineChart(lineChartData)
                createBarChart(barChartData)
                createTable(tableData)
            }

            ////  Bubble Chart  //////////////////////////////////////////////////////////////////
            var diameter = 960,
                format = d3.format(",d")
                
                var color = ["#993404", "#fe9929", "grey"]
            function createBubbleChart(bubbleChartData) {

                var bubble = d3.pack()
                //  .sort(null)
                //  .sort(d3.ascending)
                //  .sort(d3.descending)
                  //    .sort( function(a, b) { return  -1;} ) // basically a < b always
                    .size([diameter, diameter])
                    .padding(1.5)

                var svg = d3.select("body").append("svg")
                    .attr("width", diameter)
                    .attr("height", diameter)
                    .attr("class", "bubble")

                    var node = svg.selectAll(".node")
                            .data(bubble.nodes(classes(root))
                            .filter(function(d) { return !d.children; }))
                            .enter().append("g")
                            .attr("class", "node")
                            .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

                    node.append("title")
                        .text(function(d) { return d.className + ": " + format(d.value); });

                    node.append("circle")
                        .attr("r", function(d) { return d.r; })
                        .style("fill", function(d) 
                                { 
                                    // return color(d.packageName); 
                                    return color(d.value); // this gives a different color for every leaf node
                                });

                    node.append("text")
                        .attr("dy", ".3em")
                        .style("text-anchor", "middle")
                        // .text(function(d) { return d.className.substring(0, d.r / 3); });
            }

            function classes(root) 
{
  var classes = [];

  function recurse(name, node) {
    if (node.children) node.children.forEach(function(child) { recurse(node.name, child); });
    else classes.push({packageName: name, className: node.name, value: node.size});
  }

  recurse(null, root);
  return {children: classes};
}

d3.select(self.frameElement).style("height", diameter + "px");

            ////  Line Chart  //////////////////////////////////////////////////////////////////
            function createLineChart(lineChartData) {

                // Add Chart Title
                lineChartSvg.append("text")
                    .text("Skill Growth over Time")
                    .attr("class", "title")
                    .attr("x", 50)
                    .attr("y", -15)

                // Create X Axis
                var x = d3.scaleTime()
                    .domain(d3.extent(lineChartData, function(d) { return d3.timeParse("%Y-%m-%d")(d.date) }))
                    .range([0, width / 2 - 100])
                lineChartSvg.append("g")
                    .attr("transform", "translate(0," + height / 2 + ")")
                    .call(d3.axisBottom(x)
                        .tickValues(x.ticks().filter(function(d, i) { // Only show every 4th tick
                            return i % 4 === 0
                        }))
                        .tickFormat(d3.timeFormat("%Y")))  
                        .attr("class", "chart-text")

                // Create X Axis Group
                var x_axis = lineChartSvg.append("g")
                    .attr("id", "x-axis-a")
                    .attr("transform", "translate(0," + height + ")") // Flipping to the bottom
                    .call(d3.axisBottom(x))

                // Add X Axis Label
                x_axis.append("text")
                    .text("Year")
                    .attr("class", "axis-text")
                    .attr("x", 225)
                    .attr("y", -215)
                    .style("fill", "black")

                // Max Value Observed for Y Axis
                const max = d3.max(lineChartData, function(d){return 1.0})

                // Create Y Axis
                var y = d3.scaleLinear()
                    .domain([0, max])
                    .range([height / 2, 0])
                y_axis = lineChartSvg.append("g")
                    .call(d3.axisLeft(y))
                    .attr("class", "chart-text")

                // Add Y Axis Label
                y_axis.append("text")
                    .text("Value")
                    .attr("class", "axis-text")
                    .attr("transform", "rotate(-90)")
                    .attr("x", -110)
                    .attr("y", -35)
                    .style("fill", "black")

                // Create Group for Lines
                var linesElement = lineChartSvg.append("g")
                    .attr("id", "lines")

                // Set Color Gradient: From [4]
                // To Use, Write: "url(#line-gradient)"
                /* lineChartSvg.append("linearGradient")
                .attr("id", "line-gradient")
                .attr("gradientUnits", "userSpaceOnUse")
                .attr("x1", 0)
                .attr("y1", y(0))
                .attr("x2", 0)
                .attr("y2", y(max))
                .selectAll("stop")
                    .data([
                    {offset: "0%", color: "lightpurple"}, // Previously lightpurple
                    {offset: "100%", color: "rgb(116, 196, 118)"} // Previously lightgreen
                    ])
                .enter()
                    .append("stop")
                    .attr("offset", function(d) { return d.offset })
                    .attr("stop-color", function(d) { return d.color }) */
                
                // Set Color Scheme, Colors from [18]
                var unused_color_set = ["#F05039", "#E57A77", "#EEBAB4", "lightslategrey", "#3D65A5",
                    "#7CA1CC", "#A8B6CC"]
                // var colors = ["#E57A77", "#3D65A5", "grey"]
                var colors = ["#993404", "#fe9929", "grey"]

                // Create Labels for Series
                seriesLabels = ["Avg Loudness", "Avg Speechiness", "Avg Acousticness"]

                // Create Lines and Labels
                for (let i in seriesLabels) {
                    var line = linesElement // Lines
                        .append("path")
                        .datum(lineChartData)
                        .attr("d", d3.line()
                        .x(d => { return x(d3.timeParse("%Y-%m-%d")(d.date)) })
                        .y(d => { const yValue = y(d[seriesLabels[i]])
                            return yValue}))
                        .attr("class", "line")
                        .attr("id", "line-number-" + i)
                        .attr("stroke-width", 3)
                        .style("fill","none")
                        .style("stroke", colors[i])
                        .style("stroke-dasharray", ("3, 3"))
                        .on("mouseover", function () {
                            d3.select(this).style("stroke-dasharray", null)
                        })
                        .on("mouseout", function () {
                            d3.select(this).style("stroke-dasharray", ("3, 3"))
                        })
                    
                    linesElement // Line Text Labels
                        .append("text")
                        .datum(lineChartData)
                        .text(seriesLabels[i])
                        .attr("x", 382)
                        .attr("y", function (d) {
                                return y(d[d.length - 1][seriesLabels[i]]) + 2
                            })
                        .attr("class", "line-label-text") 
                        .style("fill", "black")
                        .on("mouseover", function () {
                            var thisLineNumber = "#line-number-" + i
                            d3.select(thisLineNumber).style("stroke-dasharray", null)
                        })
                        .on("mouseout", function () {
                            var thisLineNumber = "#line-number-" + i
                            d3.select(thisLineNumber).style("stroke-dasharray", ("3, 3"))
                        })

                    /* linesElement // Line Circle Labels
                        .append("g")
                        .append("circle")
                        .attr("fill", colors[i])
                        .attr("r", 5)
                        .attr("cx", 410)
                        .attr("cy", d => { return y(d[seriesLabels[i]]) })
                        .on("mouseover", function () {
                            var thisLineNumber = "#line-number-" + i
                            d3.select(thisLineNumber).style("stroke-dasharray", null)
                        })
                        .on("mouseout", function () {
                            var thisLineNumber = "#line-number-" + i
                            d3.select(thisLineNumber).style("stroke-dasharray", ("3, 3"))
                        }) */
                }
            }

            ////  Bar Chart  //////////////////////////////////////////////////////////////////
            // Based on [3]
            function createBarChart(barChartData) {

                // Add Chart Title
                barChartSvg.append("text")
                    .text("Coursework Taken - Weighted by Couse Number")
                    .attr("class", "title")
                    .attr("x", width / 4 - 170)
                    .attr("y", -15)

                // Create Y Axis
                var y = d3.scaleBand()
                    .range([0, height / 2])
                    .domain(barChartData.map(function (d) { return d.song_feature }))
                    .padding(0.2)

                // Create Y Axis Group
                var y_axis = barChartSvg.append("g")
                    .attr("id", "y-axis-a")
                    .call(d3.axisLeft(y))
                    .attr("class", "chart-text")

                // Add Y Axis Label
                y_axis.append("text")
                    .text("Feature")
                    .attr("class", "axis-text")
                    .attr("transform", "rotate(-90)")
                    .attr("x", -100)
                    .attr("y", -90)
                    .style("fill", "black")

                // Create X Axis
                var maxValue = d3.max(barChartData, function (d) { return d.value }) * 1.05 // Max value of X plus a buffer of 0.05
                var x = d3.scaleLinear()
                    .domain([0, maxValue])
                    .range([0, width / 2 - 80])

                // Add X Axis
                var x_axis = barChartSvg.append("g")
                    .call(d3.axisBottom(x))
                    .attr("class", "chart-text")
                    .attr("transform", "translate(0," + height / 2 + ")")

                // Add X Axis Label
                x_axis.append("text")
                    .text("Mean Decrease in Impurity")
                    .attr("class", "axis-text")
                    .attr("x", width / 4 - 65)
                    .attr("y", 35)
                    .style("fill", "black")

                // Create Bars
                barChartSvg.selectAll("mybar")
                    .data(barChartData)
                    .enter()
                    .append("rect")
                    .attr("x", 0)
                    .attr("y", function (d) { return y(d.song_feature) })
                    .attr("width", function (d) { return x(d.value) })
                    .attr("height", y.bandwidth())
                    .attr("fill", "#d95f0e")
                    .on("mouseover", function () {
                        d3.select(this).attr("fill", "#fe9929")
                    })
                    .on("mouseout", function () {
                        d3.select(this).attr("fill", "#d95f0e")
                    })
            }

            ////  Table  //////////////////////////////////////////////////////////////////
            // Based on [2]
            function createTable(tableData) {

                // Create Table Element
                table = d3.select('#table').append('table')
                            .style("border-collapse", "collapse")
                            .style("border", "0px black solid")
                            .style("width", "1099px") // TODO: Pass in choropleth_width

                // Add a Centered Table Title Row
                var captionRow = table.append("thead")
                    .append("tr")
                    .attr("id", "table-title-row")

                captionRow.append("th")
                    .attr("colspan", tableData[0].length)
                    .attr("id", "table-title")
                    .style("text-align", "center")
                    .text("Work Experience")

                // Create Header Row
                table.append("thead")
                    .append("tr")
                    .selectAll("th")
                    .data(tableData[0])
                    .enter()
                    .append("th")
                    .style("background-color", "rgb(179, 179, 179)")
                    .text(d => d)

                // Create Non-header Table Rows
                var tbody = table.append("tbody")

                // Create First Row of Ideal Songs
                tbody.append("tr")
                    .selectAll("td")
                    .data(tableData[0])
                    .enter()
                    .append("td")
                    .style("background-color", "#fe9929")
                    .on("mouseover", function(){
                        d3.select(this).style("background-color", "#fed98e")
                    })
                    .on("mouseout", function(){
                        d3.select(this).style("background-color", "#fe9929")
                    })
                    .text(d => d)
                    .style("font-size", "12px")

                // Add Subsequent Rows
                tbody.selectAll("tr")
                    .data(tableData.slice(0))
                    .enter()
                    .append("tr")
                    .selectAll("td")
                    .data(d => d)
                    .enter()
                    .append("td")
                    .style("background-color", "#fdfdfd")
                    .on("mouseover", function(){
                        d3.select(this).style("background-color", "#fed98e")
                    })
                    .on("mouseout", function(){
                        d3.select(this).style("background-color", "#fdfdfd")
                    })
                    .text(d => d)
                    .style("font-size", "12px")
            }

        </script>
    </body>
</html>

<!-- Sources:
    [1] stackoverflow.com/questions/628301/the-border-radius-property-and-border-collapsecollapse-dont-mix-how-can-i-use
    [2] codepen.io/blackjacques/pen/RYVpKZ
    [3] d3-graph-gallery.com/graph/barplot_ordered.html
    [4] d3-graph-gallery.com/graph/line_color_gradient_svg.html
    [5] observablehq.com/@d3/color-schemes -- For color scheme info.
    [6] stackoverflow.com/questions/61205390/how-can-i-fix-the-devtools-failed-to-load-sourcemap-could-not-load-content-er -- For js library issues.
    [7] d3-graph-gallery.com/graph/interactivity_tooltip.html -- For an example of a tooltip.
    [8] stackoverflow.com/questions/41646689/line-break-for-d3-circle-title-tooltiptext -- For fixing newline problem.
    [9] d3-legend.susielu.com/#color-threshold -- For legend color information.
    [10] stackoverflow.com/questions/22452112/nvd3-clear-svg-before-loading-new-chart -- For clearning svg.
    [n] My previous d3 hw assignments in CSE6242.
-->